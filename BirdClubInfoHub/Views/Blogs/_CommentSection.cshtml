@model BlogDTO

@{
    var userSessionId = Context.Session.GetInt32("USER_ID") ?? 0;
}

<div class="comments-container">
    <h2 class="comments-container-title">Comments</h2>

    @foreach (var comment in Model.Comments)
    {
        <div class="comment-container">
            <hr />
            <div class="comment-body">
                <div class="comment-author-ava-container">
                    <img class="comment-author-ava" src="@Url.Action("GetImageFromBytes", "Profile", new { id = comment.User.Id })" alt="avatar" />
                </div>

                <div class="comment-content-container" data-comment-id="@comment.Id">
                    <div class="comment-info-container">
                        <p class="comment-author">@comment.User.Name</p>

                        @{
                            if (comment.ModifiedDate != null)
                            {
                                <p class="comment-date">Edited @comment.ModifiedDate</p>
                            }
                            else
                            {
                                <p class="comment-date">@comment.CreatedDate</p>
                            }
                        }
                    </div>

                    <div class="comment-content" data-id="@comment.Id">@comment.Contents</div>

                    @{
                        var updateComment = new CommentDTO();
                        updateComment.Id = comment.Id;
                        updateComment.Blog.Id = Model.Id;
                        updateComment.User.Id = comment.User.Id;
                        updateComment.Contents = comment.Contents;
                    }

                    @if (comment.User.Id == userSessionId)
                    {
                        <div class="update-comment-container">
                            <button
                                type="button"
                                class="edit-button"
                                onclick="initEdit(@comment.Id)">Edit</button>

                            <button
                                type="button"
                                class="delete-button"
                                onclick="initDelete(@comment.Id)">Delete</button>
                        </div>
                    }
                </div>

                @await Html.PartialAsync("_EditComment", updateComment)
                @await Html.PartialAsync("_DeleteComment", updateComment)
            </div>
        </div>
    }

    @{
        var addComment = new CommentDTO();
        addComment.Blog.Id = Model.Id;
        addComment.User.Id = userSessionId;
    }
    @await Html.PartialAsync("_AddComment", addComment);
</div>